<div *ngIf="character" class="min-h-screen bg-parchment p-4">
  <div class="max-w-7xl mx-auto">
    
    <!-- Header with character name and controls -->
    <div class="character-sheet p-6">
      <div class="flex justify-between items-center">
        <div>
          <h1 class="gothic-header text-3xl">{{ character.name }}</h1>
        </div>
        <div class="flex gap-2 items-center">
          <button (click)="showDiceHistory = !showDiceHistory" 
                  class="skill-check-button">
            üé≤ {{ 'character.sheet.dice.history' | dynamicTranslate }}
          </button>
          <button (click)="goBack()" 
                  class="px-4 py-2 bg-gray-500 text-white rounded hover:bg-gray-600">
            ‚Üê {{ 'character.sheet.back' | dynamicTranslate }}
          </button>
          <app-language-switcher></app-language-switcher>
        </div>
      </div>
    </div>

    <div class="grid grid-cols-1 tablet-lg:grid-cols-3 gap-6">
      
      <!-- Left Column: Characteristics & Combat -->
      <div class="space-y-6">
        
        <!-- Characteristics -->
        <app-characteristic-card 
          [character]="character"
          [showRecalculationNotice]="showRecalculationNotice"
          (characterChange)="onCharacterChange($event)"
          (saveCharacter)="saveCharacter()"
          (rollCharacteristicCheck)="onRollCharacteristicCheck($event)">
        </app-characteristic-card>

        <!-- Health & Sanity -->
        <app-health-card 
          [character]="character"
          (characterChange)="onCharacterChange($event)"
          (saveCharacter)="saveCharacter()"
          (rollSanityCheck)="onRollSanityCheck()">
        </app-health-card>

        <!-- Combat -->
        <app-combat-card 
          [character]="character"
          (characterChange)="onCharacterChange($event)"
          (saveCharacter)="saveCharacter()">
        </app-combat-card>

        <!-- Movement -->
        <app-movement-card 
          [character]="character"
          (characterChange)="onCharacterChange($event)"
          (saveCharacter)="saveCharacter()">
        </app-movement-card>
      </div>

      <!-- Middle Column: Skills -->
      <div class="space-y-6">
        
        <!-- Skills List -->
        <app-skills-card 
          [character]="character"
          (characterChange)="onCharacterChange($event)"
          (saveCharacter)="saveCharacter()"
          (rollSkillCheck)="onRollSkillCheck($event)">
        </app-skills-card>
      </div>

      <!-- Right Column: Personal Details -->
      <div class="space-y-6">
        
        <!-- Basic Info -->
        <app-basic-info-card 
          [character]="character"
          [onAgeChange]="onAgeChange.bind(this)"
          (characterChange)="onCharacterChange($event)"
          (saveCharacter)="saveCharacter()">
        </app-basic-info-card>

        <!-- Fortune -->
        <app-fortune-card 
          [character]="character"
          (characterChange)="onCharacterChange($event)"
          (saveCharacter)="saveCharacter()">
        </app-fortune-card>

        <!-- Equipment -->
        <app-equipment-card 
          [character]="character"
          (characterChange)="onCharacterChange($event)"
          (saveCharacter)="saveCharacter()">
        </app-equipment-card>

        <!-- Background -->
        <app-background-card 
          [character]="character"
          (characterChange)="onCharacterChange($event)"
          (saveCharacter)="saveCharacter()">
        </app-background-card>
      </div>
    </div>

    <!-- Dice History Modal -->
    <div *ngIf="showDiceHistory" class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50" 
         (click)="showDiceHistory = false">
      <div class="character-sheet m-4 p-6 max-w-md max-h-96 overflow-y-auto" (click)="$event.stopPropagation()">
        <h3 class="gothic-header text-lg mb-4">{{ 'character.sheet.dice.rolls' | dynamicTranslate }}</h3>
        <div class="space-y-2">
          <div *ngFor="let roll of rollHistory" class="border-b border-gray-200 pb-2">
            <div class="text-sm font-medium">{{ roll.description }}</div>
            <div class="text-xs text-gray-600">
              {{ 'character.sheet.rolled' | dynamicTranslate }}{{ 'ponctuation.colon' | dynamicTranslate }} {{ roll.result }}
              <span *ngIf="roll.target"> {{ 'character.sheet.vs' | dynamicTranslate }} {{ roll.target }}%</span>
              <span *ngIf="roll.criticalSuccess" class="text-yellow-600 font-bold"> - {{ 'character.sheet.critical' | dynamicTranslate }}</span>
              <span *ngIf="roll.extremeSuccess" class="text-green-600 font-bold"> - {{ 'character.sheet.extreme' | dynamicTranslate }}</span>
              <span *ngIf="roll.hardSuccess" class="text-green-600"> - {{ 'character.sheet.hard' | dynamicTranslate }}</span>
              <span *ngIf="roll.regularSuccess" class="text-green-500"> - {{ 'character.sheet.regular' | dynamicTranslate }}</span>
              <span *ngIf="roll.failure && !roll.fumble" class="text-red-600"> - {{ 'character.sheet.failure' | dynamicTranslate }}</span>
              <span *ngIf="roll.fumble" class="text-red-800 font-bold"> - {{ 'character.sheet.fumble' | dynamicTranslate }}</span>
            </div>
          </div>
          <div *ngIf="rollHistory.length === 0" class="text-gray-500 italic text-sm">{{ 'character.sheet.no.rolls' | dynamicTranslate }}</div>
        </div>
      </div>
    </div>
  </div>
</div>

<div *ngIf="!character" class="min-h-screen bg-parchment p-4 flex items-center justify-center">
  <div class="character-sheet p-6 text-center">
    <h2 class="gothic-header text-2xl mb-4">{{ 'character.sheet.notFound' | dynamicTranslate }}</h2>
    <button (click)="goBack()" class="skill-check-button">{{ 'character.sheet.return' | dynamicTranslate }}</button>
  </div>
</div>