<div *ngIf="character" class="min-h-screen bg-parchment p-4">
  <div class="max-w-7xl mx-auto">
    
    <!-- Header with character name and controls -->
    <div class="character-sheet p-6 pb-0">
      <div class="flex flex-col tablet:flex-row justify-between tablet:items-center gap-4 mb-4">
        <div>
          <h1 class="gothic-header text-3xl">{{ character.name }}</h1>
        </div>
        <div class="flex flex-wrap gap-2 items-center">
          <button (click)="showDiceHistory = !showDiceHistory" 
                  class="skill-check-button">
            🎲 {{ 'character.sheet.dice.history' | dynamicTranslate }}
          </button>
          <button (click)="goBack()" 
                  class="px-4 py-2 bg-gray-500 text-white rounded hover:bg-gray-600">
            ← {{ 'character.sheet.back' | dynamicTranslate }}
          </button>
          <app-language-switcher></app-language-switcher>
        </div>
      </div>
    </div>

    <div class="grid grid-cols-1 tablet-lg:grid-cols-3 gap-6">
      
      <!-- Left Column: Characteristics & Combat -->
      <div class="space-y-6">
        
        <!-- Characteristics -->
        <app-characteristic-card 
          [character]="character"
          [showRecalculationNotice]="showRecalculationNotice"
          (characterChange)="onCharacterChange($event)"
          (saveCharacter)="saveCharacter()"
          (rollCharacteristicCheck)="onRollCharacteristicCheck($event)">
        </app-characteristic-card>

        <!-- Health & Sanity -->
        <app-health-card 
          [character]="character"
          (characterChange)="onCharacterChange($event)"
          (saveCharacter)="saveCharacter()"
          (rollSanityCheck)="onRollSanityCheck()">
        </app-health-card>

        <!-- Combat -->
        <app-combat-card 
          [character]="character"
          (characterChange)="onCharacterChange($event)"
          (saveCharacter)="saveCharacter()">
        </app-combat-card>

        <!-- Movement -->
        <app-movement-card 
          [character]="character"
          (characterChange)="onCharacterChange($event)"
          (saveCharacter)="saveCharacter()">
        </app-movement-card>
      </div>

      <!-- Middle Column: Skills -->
      <div class="space-y-6">
        
        <!-- Skills List -->
        <app-skills-card 
          [character]="character"
          (characterChange)="onCharacterChange($event)"
          (saveCharacter)="saveCharacter()"
          (rollSkillCheck)="onRollSkillCheck($event)">
        </app-skills-card>
      </div>

      <!-- Right Column: Personal Details -->
      <div class="space-y-6">
        
        <!-- Basic Info -->
        <app-basic-info-card 
          [character]="character"
          [onAgeChange]="onAgeChange.bind(this)"
          (characterChange)="onCharacterChange($event)"
          (saveCharacter)="saveCharacter()">
        </app-basic-info-card>

        <!-- Profile -->
        <app-profile-card 
          [character]="character"
          (characterChange)="onCharacterChange($event)"
          (saveCharacter)="saveCharacter()">
        </app-profile-card>

        <!-- Relationships -->
        <app-relationships-card 
          [character]="character"
          (characterChange)="onCharacterChange($event)"
          (saveCharacter)="saveCharacter()">
        </app-relationships-card>

        <!-- Fortune -->
        <app-fortune-card 
          [character]="character"
          (characterChange)="onCharacterChange($event)"
          (saveCharacter)="saveCharacter()">
        </app-fortune-card>

        <!-- Equipment -->
        <app-equipment-card 
          [character]="character"
          (characterChange)="onCharacterChange($event)"
          (saveCharacter)="saveCharacter()">
        </app-equipment-card>

        <!-- Notes -->
        <app-notes-card 
          [character]="character"
          (characterChange)="onCharacterChange($event)"
          (saveCharacter)="saveCharacter()">
        </app-notes-card>
      </div>
    </div>

    <!-- Dice History Modal -->
    <app-modal
      [isOpen]="showDiceHistory"
      [title]="'character.sheet.dice.rolls' | dynamicTranslate"
      type="dialog"
      [closeOnClickOutside]="true"
      [maxWidth]="'max-w-md'"
      (close)="onCloseDiceHistory()">
      <app-dice-history [rollHistory]="rollHistory"></app-dice-history>
    </app-modal>

    <!-- Dice Result Modal -->
    <app-modal
      *ngIf="currentDiceRoll"
      [isOpen]="showDiceResult"
      [title]="'character.sheet.dice.result' | dynamicTranslate"
      type="dialog"
      [closeOnClickOutside]="true"
      [maxWidth]="'max-w-lg'"
      (close)="onCloseDiceResult()">
      <app-dice-result [roll]="currentDiceRoll"></app-dice-result>
    </app-modal>
  </div>
</div>

<div *ngIf="!character" class="min-h-screen bg-parchment p-4 flex items-center justify-center">
  <div class="character-sheet p-6 text-center pb-4 border-b border-gray-300 mb-4">
    <h2 class="gothic-header text-2xl mb-4">{{ 'character.sheet.notFound' | dynamicTranslate }}</h2>
    <button (click)="goBack()" class="skill-check-button">{{ 'character.sheet.return' | dynamicTranslate }}</button>
  </div>
</div>